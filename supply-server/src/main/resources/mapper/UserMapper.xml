<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC ".//mybatis.org//DTO Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yitai.mapper.UserMapper">
    <insert id="assRole">
        insert into user_role_1(id, user_id, role_id, create_time,
                                                              update_time, create_user, update_user, is_del)
        values
        <foreach collection="list" separator="," item="item">
            (#{item.id},#{item.userId},#{item.roleId},#{item.createTime},
             #{item.updateTime}, #{item.createUser}, #{item.updateUser}, #{item.isDel})
        </foreach>
    </insert>
    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        insert into public_user(id, username, openid, realname, password, phone, email, sex,
                               id_number, status, avatar, create_time, update_time, create_user, update_user, is_del)
        values (#{id}, #{username},#{openid}, #{realname}, #{password}, #{phone}, #{email}, #{sex},
                #{idNumber}, #{status}, #{avatar}, #{createTime}, #{updateTime}, #{createUser},
                #{updateUser}, #{isDel})

    </insert>
    <insert id="insertUserTenant">
        insert into public_user_tenant(id, user_id, tenant_id, create_time, update_time, create_user, update_user, is_del)
        values (#{id}, #{userId}, #{tenantId}, #{createTime}, #{updateTime}, #{createUser},
                #{updateUser}, #{isDel})
    </insert>

    <update id="update" parameterType="User">
        update public_user
        <set>
            <if test="username != null">username = #{username},</if>
            <if test="realname != null">realname = #{realname},</if>
            <if test="password != null">password = #{password},</if>
            <if test="phone != null">phone = #{phone},</if>
            <if test="email != null">email = #{email},</if>
            <if test="sex != null">sex = #{sex},</if>
            <if test="idNumber != null">id_number = #{idNumber},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="updateUser != null">update_user = #{updateUser},</if>
            <if test="status != null">status = #{status}</if>
        </set>
        where id = #{id}
    </update>
    <select id="pageQuery" resultType="com.yitai.entity.User">
        select *
        from public_user
        <where>
            <if test="username !=null and username != ''">
                and username like concat('%',#{username},'%')
            </if>
                and is_del = 0
        </where>
        order by create_time desc
    </select>
    <select id="pageMenu" resultType="com.yitai.vo.MenuVO">
        select m.id, m.menu_name,m.menu_type,m.menu_path,m.menu_pid, m.sort_no
        from public_user u
                 join user_role_1 ur on u.id = ur.user_id
                 join role_1 r on ur.role_id= r.id
                 join role_menu_1 rm on r.id = rm.role_id
                 join public_menu m on rm.menu_id = m.id
        <where>
            and user_id = #{id}
            <if test="typeList !=null and typeList != ''">
                and m.menu_type in
                    <foreach collection="typeList" item="item"
                             open="(" close=")" separator=",">
                        #{item}
                    </foreach>
            </if>
        </where>
    </select>

    <select id="pageAllMenu" resultType="com.yitai.vo.MenuVO">
        select *
        from public_menu
        <where>
            <if test="typeList !=null and typeList != ''">
                and menu_type in
                <foreach collection="typeList" item="item"
                         open="(" close=")" separator=",">
                    #{item}
                </foreach>
            </if>
        </where>
    </select>

    <select id="getTenant" resultType="com.yitai.entity.Tenant">
        select public_tenant.id, public_tenant.tenant_id, public_tenant.tenant_name
        from public_user_tenant
        join public_tenant on public_tenant.id = public_user_tenant.tenant_id
        <where>
            <if test="userId !=null and userId != ''">
                and public_user_tenant.user_id = #{userId}
            </if>
                and public_tenant.is_del = 0
        </where>
    </select>

</mapper>